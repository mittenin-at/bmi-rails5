<% content_for :script do %>
  <%= javascript_include_tag "jquery-1.6.min", "rails", "highcharts", "modules/exporting", "themes/grid" %>
  <script type="text/javascript">
    jQuery.noConflict();
  </script>
<% end %>

<div class="block">
  <div class="secondary-navigation">
    <ul class="wat-cf">
      <li class="first"><%= link_to "#{t("web-app-theme.list", :default => "List")}", weighings_path  %></li>
      <li><%= link_to "#{t("web-app-theme.new", :default => "New")}", new_weighing_path %></li>
      <li class="active"><%= link_to "#{t("web-app-theme.diagram")}", diagram_weighings_path %></li>
      <li><%= link_to "#{t("web-app-theme.compare")}", select_competitor_weighings_path %></li>
    </ul>
  </div>
  <div class="content">
    <div class="inner">
      <h2>Diagramm des zeitlichen Verlaufs Ihres Body Mass Index</h2>
        <p>

<script type="text/javascript" charset="utf-8">
  jQuery(document).ready(function() {
    Highcharts.setOptions({ lang: { months: ['Jänner', 'Februar', 'März', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'],
                               		  weekdays: ['Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnertag', 'Freitag', 'Samstag'] } });
    chart= new Highcharts.Chart({
      chart: { renderTo: 'diagram', defaultSeriesType: 'spline', zoomType: 'x' },
      title: { text: 'BMI' },
      xAxis: { type: 'datetime' },
      yAxis: { title: { text: 'BMI' },
         min: <%= @minbmi %>,
         max: <%= @maxbmi %>,
         minorGridLineWidth: 0,
         gridLineWidth: 0,
         alternateGridColor: null,
         plotBands: [{ from: 15, to: 16, color: 'rgba(0, 100, 255, 0.4)',
                       label: { text: 'starkes Untergewicht', style: { color: Highcharts.theme.textColor || '#606060' }}},
                     { from: 16, to: 17, color: 'rgba(0, 150, 255, 0.4)',
                       label: { text: 'mäßiges Untergewicht', style: { color: Highcharts.theme.textColor || '#606060' }}},
                     { from: 17, to: 18.5, color: 'rgba(0, 255, 255, 0.4)',
                       label: { text: 'leichtes Untergewicht', style: { color: Highcharts.theme.textColor || '#606060' }}},
                     { from: 18.5, to: 25, color: 'rgba(0, 255, 0, 0.4)',
                       label: { text: 'Normalgewicht', style: { color: Highcharts.theme.textColor || '#606060' }}},
                     { from: 25, to: 30, color: 'rgba(255, 255, 0, 0.4)',
                       label: { text: 'Übergewicht', style: { color: Highcharts.theme.textColor || '#606060' }}},
                     { from: 30, to: 35, color: 'rgba(255, 140, 100, 0.4)',
                       label: { text: 'Adipositas Grad I', style: { color: Highcharts.theme.textColor || '#606060' }}},
                     { from: 35, to: 40, color: 'rgba(255, 0, 0, 0.4)',
                       label: { text: 'Adipositas Grad II', style: { color: Highcharts.theme.textColor || '#606060' }}},
                     { from: 40, to: 45, color: 'rgba(100, 0, 0, 0.4)',
                       label: { text: 'Adipositas Grad III', style: { color: Highcharts.theme.textColor || '#606060' }}}
                     ],
         <% unless @target.nil? %>          
           plotLines: [{ value: <%= @target %>, color: '#001100', width: 1, zindex: 3, dashStyle: 'dashdot',
                         label: { text: 'Wunschgewicht', style: { color: '#001100' }}
                      }],                
         <% end %> 
      },
      tooltip: { formatter: function() { return ''+ Highcharts.dateFormat('%e. %B %Y', this.x) +': '+ this.point.weight +" kg"; } },
      plotOptions: {
         spline: { lineWidth: 1,
            states: { lineWidth: 3 },
            marker: { enabled: true, symbol: 'circle', radius: 3, 
               states: { hover: { enabled: true, symbol: 'circle', radius: 5, lineWidth: 1 }}
            },
         }
      },
      series: [{
         name: '<%= @weighings.first.user.email %>',
         data: [
         <% @weighings.each do |weighing| %> {
           x: Date.UTC(<%= weighing.date.year %>, <%= weighing.date.month-1 %>, <%= weighing.date.day %>),
           y: <%= (weighing.weight * 100 * 100 / @height / @height).round(2) %>,
           weight: <%= weighing.weight %>
         },
         <% end %>
         ]
      }],
      navigation: { menuItemStyle: { fontSize: '10px' } }
   });
});
</script>
<span id="diagram" class="highcharts-container" style="display:inline; margin:10px; height:400px"></span>
        </p>
    </div>
  </div>
</div>
<% content_for :sidebar, render(:partial => 'layouts/sidebar') -%>

